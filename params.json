{"name":"Json2json","body":"# About json2json\r\n\r\nTransforms one JSON object structure to another structure as defined by template rules. \r\nIdeal for transforming JSON retrieved from web services to be used the way you need it in your application. \r\n\r\njson2json is written in CoffeeScript and designed to run in a Node.js envirionment. \r\nIt can be easily converted to JavaScript to be used in a browser as well.\r\n\r\n## Template rules\r\n\r\nTemplate rules specify how the \"original JSON\" (raw data) is transformed to the \"new JSON\" format you need: \r\n\r\nA template specifies the **path** to the value on your original JSON you want to transform \r\nand assumes that value is either an object or an array. \r\nIf it's an object, you can **choose** which properties you want to transform.\r\nIf it's an array, you can **aggregate** the values you want to transform. \r\n\r\nSometimes you want to convert an array to a map (aka JSON object). \r\nTo do this, you can specify what value on your original JSON to use as the **key**. \r\nIf you want to make it a really simple map, \r\nyou can specify what value on your original JSON to use as the **value**. \r\n\r\nTemplates specify how the original JSON data will be represented **as** properties on the new JSON. \r\n(The only time the **as** rules are ignored is if the **value** rule exists \r\nwhen converting an array to a map.) \r\n\r\n## Describing the example template\r\n\r\n(Look at the \"example\" folder to see this template and the JSON before and after transformation.) \r\n\r\nA template specifies a set of rules that describe how to transform a property in your original JSON. \r\nA template itself is a javascript object. \r\nThis example is written in CoffeeScript and has comments to explain each property: \r\n\r\nThe template object is stored as the \"tmpl\" variable. \r\nThe template typically matches the root of the original JSON. \r\n\r\n    tmpl = \r\n    \r\nThe \"path\" property specifies what property on the JSON object to process. \r\nThe '.' value specifies to use the root in this case. \r\nThe original JSON can be an array as well. \r\n\r\n      path: '.' \r\n      \r\nThe \"aggregate\" property (optional) is used if you are processing an array. \r\nIt lets you process values of an array and combine them into one value or effectively filter an array. \r\nThe properties in the \"aggregate\" object are used as properties on your new JSON object. \r\nThe \"existing\" parameter sent to each aggregate function specifies a value if one exists on your new JSON object. \r\n\r\n      aggregate:  \r\n        total: (key, value, existing) -> if !sysmo.isArray(value) then value else value.sort().reverse()[0] \r\n        pages: (key, value, existing) -> if !sysmo.isArray(value) then value else value.sort().reverse()[0] \r\n\r\nThe \"as\" property lets you specify all the properties you want on your new JSON object. \r\n(These are the only properties that will be created on the new JSON object.) \r\nThis is where you define the mapping rules. \r\nIt is effectively a list of nested templates. \r\n\r\n      as: \r\n\r\nThe \"bins\" property is going to be created on your new JSON object. \r\nThe template defined for \"bins\" here is another set of rules that specify what property \r\non the original JSON object to transform. \r\n\r\n        bins:  \r\n\r\nThe \"path\" property was described previously. \r\nHowever, this time the path is relative to the value in the original JSON that was selected by the previous \"path\" (above). \r\nIt is possible to access properties of objects that are in an array. \r\nA flattened array of all values will be returned and used as the value to transform. \r\n\r\n          path: 'Items.SearchBinSets.SearchBinSet.Bin' \r\n\r\nThe \"key\" property indicates you want to convert an array to a map. \r\nThe \"key\" property lets you specify the property in the original JSON object to use as the key in the new map. \r\nThe value retrieved from the original JSON object will be converted to a string. \r\n(Alternatively, you can specify a function that is passed the original JSON value and returns a key to use.) \r\n\r\n          key: 'BinParameter.Value' \r\n\r\nThe \"value\" property (optional) lets you specify the property in the original JSON object to use as the value in the new map. \r\n(Alternatively, you can specify a function that is passed the original JSON value and returns a value to use.) \r\n\r\n          value: 'BinItemCount' \r\n\r\nThe \"aggregate\" property works the same as previously described, but instead of specifying a map of functions, \r\na single function is used to aggregate the array values being processed on the original JSON object.\r\n\r\n          aggregate: (key, value, existing) -> Math.max(value, existing || 0) \r\n        items:  \r\n          path: 'Items.Item' \r\n\r\nThe \"all\" property specifies that all properties on the matched object in the original JSON object for which \r\nno rule has been defined should automatically be copied to the new JSON object. \r\n(By default, only the properties specified in the \"as\" template are created on the new JSON.) \r\nThe \"all\" option only works if \"choose\" is not defined (see below). \r\n\r\n          all: true \r\n          as: \r\n            title: 'ItemAttributes.Title' \r\n            price: 'Offers.Offer.OfferListing.Price.FormattedPrice' \r\n            similar: \r\n              path: 'SimilarProducts.SimilarProduct' \r\n              key: 'ASIN' \r\n              value: 'Title' \r\n            images: \r\n              path: '.' \r\n\r\nThe \"choose\" property defines an array of properties on the original JSON object to transform and skip the rest. \r\n\r\n              choose: ['SmallImage', 'MediumImage', 'LargeImage'] \r\n\r\nThe \"format\" property defines a function that processes each of the values retrieved from the original JSON object \r\nand returns an object with \"key\" and \"value\" properties. \r\nThis allows you to format the key and value however you wish. \r\n(If a \"key\" or \"value\" property is not returned, the original value is used.) \r\nThe \"node\" parameter to the format function is the object or array in the original JSON that is being transformed. \r\n(It is the object that contains the properties defined by the \"choose\" array.)\r\n\r\n              format: (node, value, key) -> key: key.replace(/Image$/, '').toLowerCase() \r\n\r\nThe \"nested\" property indicates that the value of each property specified by \"choose\" should be a new object. \r\nThe properties defined in the \"as\" template below will be stored in the nested object instead of the object that the \r\n\"choose\" properties are created on.\r\n\r\n              nested: true \r\n              as: \r\n                url: 'URL' \r\n                height: 'Height.#'  \r\n                width: 'Width.#' \r\n            image_sets: \r\n              path: 'ImageSets.ImageSet' \r\n              key: '@.Category' \r\n\r\nThe \"choose\" property can be a function that returns a boolean. \r\nIn the previous \"choose\" example, an array of property names (e.g. map/hash \"keys\") were specified, \r\nwhich indicated what properties on the original JSON value to transform. \r\nTo provide more flexibility, a function can be used to dynamically choose which properties to transform. \r\n\r\n              choose: (node, value, key) -> key isnt '@' \r\n              format: (node, value, key) -> key: key.replace(/Image$/, '').toLowerCase() \r\n              nested: true \r\n              as: \r\n                url: 'URL' \r\n                height: 'Height.#' \r\n                width: 'Width.#' \r\n\r\nAnd finally, create an instance of the \"ObjectTemplate\" object, \r\npassing the template to the constructor. \r\nThen call the \"transform\" method, passing it the data you want to transform. \r\n\r\n    new ObjectTemplate(tmpl).transform data \r\n    \r\n## TODO\r\n\r\n* Need to convert a map (object) to an array\r\n\r\n\r\n## License\r\n\r\nCreated by Joel Van Horn. Free to use however you please.","tagline":"Transform (reformat) JSON structures from one to another using JavaScript","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}